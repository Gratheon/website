<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-web-app/features/bottom-board-management" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>bottom-board-management | Gratheon</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://gratheon.com/img/gratheon-web-app.webp /><meta data-rh=true name=twitter:image content=https://gratheon.com/img/gratheon-web-app.webp /><meta data-rh=true property=og:url content=https://gratheon.com/docs/web-app/features/bottom-board-management /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="bottom-board-management | Gratheon"/><meta data-rh=true name=description content="This document describes the technical implementation of the hive bottom board feature for varroa mite monitoring. The feature spans three microservices: swarm-api, image-splitter, and web-app."/><meta data-rh=true property=og:description content="This document describes the technical implementation of the hive bottom board feature for varroa mite monitoring. The feature spans three microservices: swarm-api, image-splitter, and web-app."/><link data-rh=true rel=icon href=/favicons/favicon.ico /><link data-rh=true rel=canonical href=https://gratheon.com/docs/web-app/features/bottom-board-management /><link data-rh=true rel=alternate href=https://gratheon.com/docs/web-app/features/bottom-board-management hreflang=en /><link data-rh=true rel=alternate href=https://gratheon.com/docs/web-app/features/bottom-board-management hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://gratheon.com/docs/web-app/","name":"üì± Web-app","position":1},{"@type":"ListItem","item":"https://gratheon.com/docs/web-app/features/bottom-board-management","name":"bottom-board-management","position":2}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Gratheon RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Gratheon Atom Feed"><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-KH4KC9")</script><link rel=stylesheet href=/assets/css/styles.5035d0c0.css /><script src=/assets/js/runtime~main.93ee4b8a.js defer></script><script src=/assets/js/main.d7b5b1cd.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t;document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KH4KC9" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_poJ9 href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo_v7w.svg alt=Gratheon class="themedComponent_rn3I themedComponent--light_bBhh"/><img src=/img/logo_v7w.svg alt=Gratheon class="themedComponent_rn3I themedComponent--dark_zi9f"/></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href=/about>About</a><a class="navbar__item navbar__link" href=/about/products>Products</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/API/>Docs</a><a class="navbar__item navbar__link" sidebarid=researchSidebar href=/research>Research</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/pricing>Pricing</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class=navbarSearchContainer_rLJk><input type=text placeholder=Search style="padding:7px 15px;border:2px solid #CCC;border-radius:5px"/></div><a href=https://discord.gg/PcbP4uedWj target=_blank rel="noopener noreferrer" class="navbar__item navbar__link navbar--discord-link" aria-label="Discord Invite"></a><a href=https://github.com/gratheon/web-app target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header--github-link" aria-label="GitHub repository"></a><a href=https://app.gratheon.com/account/authenticate/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Log in<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_TcZ4"><div class=docsWrapper_a5BB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_jePA" type=button></button><div class=docRoot_YOz7><aside class="theme-doc-sidebar-container docSidebarContainer_PCNi"><div class=sidebarViewport_svvY><div class=sidebar_yZ0v><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_ib_h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/API/><span title="üîó API" class=categoryLinkLabel_dnDz>üîó API</span></a><button aria-label="Expand sidebar category 'üîó API'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--active" href=/docs/web-app/><span title="üì± Web-app" class=categoryLinkLabel_dnDz>üì± Web-app</span></a><button aria-label="Collapse sidebar category 'üì± Web-app'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/web-app/Tech stack, conventions, environments"><span title="Tech stack, conventions, environments" class=linkLabel_I9IG>Tech stack, conventions, environments</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/web-app/UX - UI wireframes"><span title="UX - UI wireframes" class=linkLabel_I9IG>UX - UI wireframes</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/docs/web-app/features/split-colony><span title=features class=categoryLinkLabel_dnDz>features</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/split-colony><span title="Split Colony - Technical Documentation" class=linkLabel_I9IG>Split Colony - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/join-colonies><span title="Join Colonies - Technical Documentation" class=linkLabel_I9IG>Join Colonies - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/frame-photo-upload><span title="Frame Photo Upload - Technical Documentation" class=linkLabel_I9IG>Frame Photo Upload - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/apiary-management><span title="Apiary Management - Technical Documentation" class=linkLabel_I9IG>Apiary Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/queen-detection><span title="Queen Detection - Technical Documentation" class=linkLabel_I9IG>Queen Detection - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/queen-management><span title="Queen Management - Technical Documentation" class=linkLabel_I9IG>Queen Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/frame-side-management><span title="Frame Side Management - Technical Documentation" class=linkLabel_I9IG>Frame Side Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/hive-management><span title="Hive Management - Technical Documentation" class=linkLabel_I9IG>Hive Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/user-registration><span title="User Registration - Technical Documentation" class=linkLabel_I9IG>User Registration - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/user-profile-editing><span title="User Profile Editing - Technical Documentation" class=linkLabel_I9IG>User Profile Editing - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/telemetry-storage><span title="Hive Telemetry Storage - Technical Documentation" class=linkLabel_I9IG>Hive Telemetry Storage - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/timeseries-analytics><span title="Timeseries Data Analytics - Technical Documentation" class=linkLabel_I9IG>Timeseries Data Analytics - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/web-app/features/bottom-board-management><span title=bottom-board-management class=linkLabel_I9IG>bottom-board-management</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href="/docs/web-app/ü•û DB schemas/gate-video-stream"><span title="ü•û DB schemas" class=categoryLinkLabel_dnDz>ü•û DB schemas</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/beehive-sensors/><span title="üå°Ô∏è Beehive IoT sensors" class=categoryLinkLabel_dnDz>üå°Ô∏è Beehive IoT sensors</span></a><button aria-label="Expand sidebar category 'üå°Ô∏è Beehive IoT sensors'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/entrance-observer/><span title="üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer" class=categoryLinkLabel_dnDz>üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer</span></a><button aria-label="Expand sidebar category 'üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/robotic-beehive/><span title="üßø Robotic beehive" class=categoryLinkLabel_dnDz>üßø Robotic beehive</span></a><button aria-label="Expand sidebar category 'üßø Robotic beehive'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href=https://github.com/orgs/Gratheon/projects/5 target=_blank rel="noopener noreferrer" class="menu__link menuExternalLink_FdF6"><span title="‚òëÔ∏è Tasks" class=linkLabel_I9IG>‚òëÔ∏è Tasks</span><svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></nav></div></div></aside><main class=docMainContainer_aHOd><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_BJgu"><div class=docItemContainer_PUtD><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_dpnR" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon__OJg><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/docs/web-app/><span>üì± Web-app</span></a><li class=breadcrumbs__item><span class=breadcrumbs__link>features</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>bottom-board-management</span></ul></nav><div class="tocCollapsible_RHmT theme-doc-toc-mobile tocMobile_VHIv"><button type=button class="clean-btn tocCollapsibleButton_POOD">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>bottom-board-management</h1></header><p>This document describes the technical implementation of the hive bottom board feature for varroa mite monitoring. The feature spans three microservices: swarm-api, image-splitter, and web-app.</p>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=architecture>Architecture<a href=#architecture class=hash-link aria-label="Direct link to Architecture" title="Direct link to Architecture" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=service-dependencies>Service Dependencies<a href=#service-dependencies class=hash-link aria-label="Direct link to Service Dependencies" title="Direct link to Service Dependencies" translate=no>‚Äã</a></h3>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=data-flow>Data Flow<a href=#data-flow class=hash-link aria-label="Direct link to Data Flow" title="Direct link to Data Flow" translate=no>‚Äã</a></h3>
<ol>
<li class="">
<p><strong>User creates bottom box</strong>:</p>
<ul>
<li class="">web-app ‚Üí graphql-router ‚Üí swarm-api</li>
<li class="">Creates record in <code>boxes</code> table with <code>type = 'BOTTOM'</code></li>
</ul>
</li>
<li class="">
<p><strong>User uploads image</strong>:</p>
<ul>
<li class="">web-app ‚Üí graphql-router ‚Üí image-splitter</li>
<li class="">Step 1: <code>uploadFrameSide</code> uploads to S3, returns <code>fileId</code></li>
<li class="">Step 2: <code>addFileToBox</code> links file to box in <code>files_box_rel</code></li>
</ul>
</li>
<li class="">
<p><strong>Image processing</strong>:</p>
<ul>
<li class="">image-splitter queues varroa detection job</li>
<li class="">Job processes image asynchronously</li>
<li class="">Results stored in <code>detectedObjects</code> JSON field</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=database-schema>Database Schema<a href=#database-schema class=hash-link aria-label="Direct link to Database Schema" title="Direct link to Database Schema" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=swarm-api-schema>swarm-api Schema<a href=#swarm-api-schema class=hash-link aria-label="Direct link to swarm-api Schema" title="Direct link to swarm-api Schema" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=boxes-table>boxes table<a href=#boxes-table class=hash-link aria-label="Direct link to boxes table" title="Direct link to boxes table" translate=no>‚Äã</a></h4>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">boxes</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>AUTO_INCREMENT</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">hive_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">active</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>tinyint</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'1'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">color</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>varchar</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>10</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'#ffc848'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">position</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>mediumint</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">type</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>enum</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'SUPER'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'DEEP'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'GATE'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'VENTILATION'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'QUEEN_EXCLUDER'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'HORIZONTAL_FEEDER'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'BOTTOM'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">         </span><span class="token keyword" style=color:#00009f>CHARACTER</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style=color:#00009f>COLLATE</span><span class="token plain"> utf8mb4_0900_ai_ci </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'DEEP'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>ENGINE</span><span class="token operator" style=color:#393A34>=</span><span class="token keyword" style=color:#00009f>InnoDB</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>CHARSET</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style=color:#00009f>COLLATE</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">utf8mb4_general_ci</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<p><strong>Migration</strong>: <code>migrations/20251201025115_add_bottom_box_type.sql</code></p>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=image-splitter-schema>image-splitter Schema<a href=#image-splitter-schema class=hash-link aria-label="Direct link to image-splitter Schema" title="Direct link to image-splitter Schema" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=files_box_rel-table>files_box_rel table<a href=#files_box_rel-table class=hash-link aria-label="Direct link to files_box_rel table" title="Direct link to files_box_rel table" translate=no>‚Äã</a></h4>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">files_box_rel</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">box_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">file_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>int</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>unsigned</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">inspection_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>INT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">added_time</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>datetime</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>CURRENT_TIMESTAMP</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>INDEX</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">box_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token identifier">inspection_id</span><span class="token identifier punctuation" style=color:#393A34>`</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>ENGINE</span><span class="token operator" style=color:#393A34>=</span><span class="token keyword" style=color:#00009f>InnoDB</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>CHARSET</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style=color:#00009f>COLLATE</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">utf8mb4_bin</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<p><strong>Migration</strong>: <code>migrations/018-box-files.sql</code></p>
<p><strong>Purpose</strong>: Links uploaded files to specific boxes with inspection versioning support.</p>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=relationships>Relationships<a href=#relationships class=hash-link aria-label="Direct link to Relationships" title="Direct link to Relationships" translate=no>‚Äã</a></h4>
<ul>
<li class=""><code>box_id</code> ‚Üí <code>swarm-api.boxes.id</code> (foreign service reference)</li>
<li class=""><code>file_id</code> ‚Üí <code>image-splitter.files.id</code></li>
<li class=""><code>user_id</code> ‚Üí user ownership</li>
<li class=""><code>inspection_id</code> ‚Üí <code>swarm-api.inspections.id</code> (NULL = current state)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=graphql-api>GraphQL API<a href=#graphql-api class=hash-link aria-label="Direct link to GraphQL API" title="Direct link to GraphQL API" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=swarm-api>swarm-api<a href=#swarm-api class=hash-link aria-label="Direct link to swarm-api" title="Direct link to swarm-api" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=add-box-mutation>Add Box Mutation<a href=#add-box-mutation class=hash-link aria-label="Direct link to Add Box Mutation" title="Direct link to Add Box Mutation" translate=no>‚Äã</a></h4>
<div class="language-graphql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-graphql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>mutation</span><span class="token plain"> </span><span class="token definition-mutation function" style=color:#d73a49>addBox</span><span class="token punctuation" style=color:#393A34>(</span><span class="token variable variable-input" style=color:#36acaa>$hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$position</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">BoxType</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property-query property-mutation">addBox</span><span class="token punctuation" style=color:#393A34>(</span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token attr-name" style=color:#00a4db>position</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$position</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token attr-name" style=color:#00a4db>type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$type</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>id</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>position</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>color</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Variables</strong>:</p>
<div class="language-json codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-json codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"hiveId"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"123"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"position"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"BOTTOM"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Implementation</strong>: <code>graph/schema.resolvers.go::AddBox()</code></p>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=image-splitter>image-splitter<a href=#image-splitter class=hash-link aria-label="Direct link to image-splitter" title="Direct link to image-splitter" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=upload-file-mutation>Upload File Mutation<a href=#upload-file-mutation class=hash-link aria-label="Direct link to Upload File Mutation" title="Direct link to Upload File Mutation" translate=no>‚Äã</a></h4>
<div class="language-graphql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-graphql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>mutation</span><span class="token plain"> </span><span class="token definition-mutation function" style=color:#d73a49>uploadFrameSide</span><span class="token punctuation" style=color:#393A34>(</span><span class="token variable variable-input" style=color:#36acaa>$file</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">Upload</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property-query property-mutation">uploadFrameSide</span><span class="token punctuation" style=color:#393A34>(</span><span class="token attr-name" style=color:#00a4db>file</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>id</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>url</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token object">resizes</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>id</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>url</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>max_dimension_px</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Returns</strong>:</p>
<div class="language-json codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-json codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"data"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"uploadFrameSide"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"id"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"456"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"url"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"https://s3.../original.jpg"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"resizes"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">...</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Implementation</strong>: <code>src/graphql/upload-frame-side.ts</code></p>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=link-file-to-box-mutation>Link File to Box Mutation<a href=#link-file-to-box-mutation class=hash-link aria-label="Direct link to Link File to Box Mutation" title="Direct link to Link File to Box Mutation" translate=no>‚Äã</a></h4>
<div class="language-graphql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-graphql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>mutation</span><span class="token plain"> </span><span class="token definition-mutation function" style=color:#d73a49>addFileToBox</span><span class="token punctuation" style=color:#393A34>(</span><span class="token variable variable-input" style=color:#36acaa>$boxId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$fileId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property-query property-mutation">addFileToBox</span><span class="token punctuation" style=color:#393A34>(</span><span class="token attr-name" style=color:#00a4db>boxId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token attr-name" style=color:#00a4db>fileId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token variable variable-input" style=color:#36acaa>$hiveId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Variables</strong>:</p>
<div class="language-json codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-json codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"boxId"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"123"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"fileId"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"456"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"hiveId"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"789"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Implementation</strong>: <code>src/graphql/resolvers.ts::addFileToBox()</code></p>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=frontend-implementation>Frontend Implementation<a href=#frontend-implementation class=hash-link aria-label="Direct link to Frontend Implementation" title="Direct link to Frontend Implementation" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=bottombox-component>BottomBox Component<a href=#bottombox-component class=hash-link aria-label="Direct link to BottomBox Component" title="Direct link to BottomBox Component" translate=no>‚Äã</a></h3>
<p><strong>Location</strong>: <code>web-app/src/page/hiveEdit/bottomBox/BottomBox.tsx</code></p>
<p><strong>Key Features</strong>:</p>
<ul>
<li class="">File upload with validation</li>
<li class="">Two-step mutation process</li>
<li class="">Error handling</li>
<li class="">Loading states</li>
</ul>
<p><strong>Code Structure</strong>:</p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>BottomBox</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> hiveId </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Step 1: Upload file</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">uploadFile</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>useUploadMutation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Step 2: Link to box</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">addFileToBoxMutation</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>useMutation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>onFileSelect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">event</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> event</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">target</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">files</span><span class="token operator" style=color:#393A34>?.</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Upload file to S3</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> uploadResult </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>uploadFile</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> file </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> fileId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> uploadResult</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">uploadFrameSide</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">id</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Link file to box</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>addFileToBoxMutation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> hiveId </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">div</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">input type</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>"file"</span><span class="token plain"> onChange</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">onFileSelect</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">data </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">img src</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">uploadFrameSide</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">div</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=integration-points>Integration Points<a href=#integration-points class=hash-link aria-label="Direct link to Integration Points" title="Direct link to Integration Points" translate=no>‚Äã</a></h3>
<p><strong>hiveButtons.tsx</strong>: Adds "Add bottom" button</p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">Button onClick</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token function" style=color:#d73a49>onBoxAdd</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">boxTypes</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>BOTTOM</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>}</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">span</span><span class="token operator" style=color:#393A34>></span><span class="token operator" style=color:#393A34>&lt;</span><span class="token constant" style=color:#36acaa>T</span><span class="token operator" style=color:#393A34>></span><span class="token plain">Add bottom</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>/</span><span class="token constant" style=color:#36acaa>T</span><span class="token operator" style=color:#393A34>></span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">span</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">Button</span><span class="token operator" style=color:#393A34>></span><br/></span></code></pre></div></div>
<p><strong>index.tsx</strong>: Renders BottomBox component</p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">box </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> box</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">type </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> boxTypes</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>BOTTOM</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">BottomBox boxId</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">boxId</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> hiveId</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hiveId</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=backend-implementation>Backend Implementation<a href=#backend-implementation class=hash-link aria-label="Direct link to Backend Implementation" title="Direct link to Backend Implementation" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=swarm-api-go>swarm-api (Go)<a href=#swarm-api-go class=hash-link aria-label="Direct link to swarm-api (Go)" title="Direct link to swarm-api (Go)" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=box-model>Box Model<a href=#box-model class=hash-link aria-label="Direct link to Box Model" title="Direct link to Box Model" translate=no>‚Äã</a></h4>
<p><strong>Location</strong>: <code>graph/model/box.go</code></p>
<p><strong>Key Methods</strong>:</p>
<ul>
<li class=""><code>Create()</code> - Creates new box with type validation</li>
<li class=""><code>ListByHive()</code> - Fetches boxes for a hive</li>
<li class=""><code>Get()</code> - Retrieves single box</li>
</ul>
<p><strong>Type Constants</strong>:</p>
<div class="language-go codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-go codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeDeep             BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"DEEP"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeSuper            BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"SUPER"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeGate             BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"GATE"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeVentilation      BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"VENTILATION"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeQueenExcluder    BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"QUEEN_EXCLUDER"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeHorizontalFeeder BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"HORIZONTAL_FEEDER"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    BoxTypeBottom           BoxType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"BOTTOM"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=image-splitter-typescript>image-splitter (TypeScript)<a href=#image-splitter-typescript class=hash-link aria-label="Direct link to image-splitter (TypeScript)" title="Direct link to image-splitter (TypeScript)" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=boxfile-model>boxFile Model<a href=#boxfile-model class=hash-link aria-label="Direct link to boxFile Model" title="Direct link to boxFile Model" translate=no>‚Äã</a></h4>
<p><strong>Location</strong>: <code>src/models/boxFile.ts</code></p>
<p><strong>Key Methods</strong>:</p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>default</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>addBoxRelation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> userId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> inspectionId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>storage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>query</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      sql</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string sql language-sql keyword" style=color:#00009f>INSERT</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql keyword" style=color:#00009f>INTO</span><span class="token template-string sql language-sql"> files_box_rel </span><br/></span><span class=token-line style=color:#393A34><span class="token template-string sql language-sql">          </span><span class="token template-string sql language-sql punctuation" style=color:#393A34>(</span><span class="token template-string sql language-sql">file_id</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> box_id</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> user_id</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> inspection_id</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>)</span><span class="token template-string sql language-sql"> </span><br/></span><span class=token-line style=color:#393A34><span class="token template-string sql language-sql">          </span><span class="token template-string sql language-sql keyword" style=color:#00009f>VALUES</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql punctuation" style=color:#393A34>(</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string sql language-sql interpolation">fileId</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string sql language-sql interpolation">boxId</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string sql language-sql interpolation">userId</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>,</span><span class="token template-string sql language-sql"> </span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string sql language-sql interpolation">inspectionId</span><span class="token template-string sql language-sql interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string sql language-sql punctuation" style=color:#393A34>)</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getBoxFiles</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> userId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> inspectionId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Returns files for specific box</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=resolver>Resolver<a href=#resolver class=hash-link aria-label="Direct link to Resolver" title="Direct link to Resolver" translate=no>‚Äã</a></h4>
<p><strong>Location</strong>: <code>src/graphql/resolvers.ts</code></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token function-variable function" style=color:#d73a49>addFileToBox</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">_</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> hiveId</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">uid</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> boxFileModel</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>addBoxRelation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> boxId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> uid</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> fileModel</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>addHiveRelation</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">fileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> uid</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>true</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=inspection-versioning>Inspection Versioning<a href=#inspection-versioning class=hash-link aria-label="Direct link to Inspection Versioning" title="Direct link to Inspection Versioning" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=how-it-works>How It Works<a href=#how-it-works class=hash-link aria-label="Direct link to How It Works" title="Direct link to How It Works" translate=no>‚Äã</a></h3>
<ol>
<li class=""><strong>Current State</strong>: Images have <code>inspection_id = NULL</code></li>
<li class=""><strong>Create Inspection</strong>:<!-- -->
<ul>
<li class="">Current images are cloned</li>
<li class="">Clones get new <code>inspection_id</code></li>
<li class="">Original images remain with <code>NULL</code> (becomes new current state)</li>
</ul>
</li>
<li class=""><strong>Historical View</strong>: Query with specific <code>inspection_id</code></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=sql-queries>SQL Queries<a href=#sql-queries class=hash-link aria-label="Direct link to SQL Queries" title="Direct link to SQL Queries" translate=no>‚Äã</a></h3>
<p><strong>Get current images</strong>:</p>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>FROM</span><span class="token plain"> files_box_rel </span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>WHERE</span><span class="token plain"> box_id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ? </span><span class="token operator" style=color:#393A34>AND</span><span class="token plain"> user_id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ? </span><span class="token operator" style=color:#393A34>AND</span><span class="token plain"> inspection_id </span><span class="token operator" style=color:#393A34>IS</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<p><strong>Get historical images</strong>:</p>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>FROM</span><span class="token plain"> files_box_rel </span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>WHERE</span><span class="token plain"> box_id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ? </span><span class="token operator" style=color:#393A34>AND</span><span class="token plain"> user_id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ? </span><span class="token operator" style=color:#393A34>AND</span><span class="token plain"> inspection_id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ?</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=job-queue-integration>Job Queue Integration<a href=#job-queue-integration class=hash-link aria-label="Direct link to Job Queue Integration" title="Direct link to Job Queue Integration" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=varroa-detection-job>Varroa Detection Job<a href=#varroa-detection-job class=hash-link aria-label="Direct link to Varroa Detection Job" title="Direct link to Varroa Detection Job" translate=no>‚Äã</a></h3>
<p>When file is uploaded, a varroa detection job is queued:</p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> jobs</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>addJob</span><span class="token punctuation" style=color:#393A34>(</span><span class="token constant" style=color:#36acaa>TYPE_VARROA</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fileId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<p><strong>Job Type</strong>: <code>TYPE_VARROA = 'varroa'</code></p>
<p><strong>Processing</strong>:</p>
<ol>
<li class="">Job worker picks up job from queue</li>
<li class="">Downloads image from S3</li>
<li class="">Runs varroa detection model</li>
<li class="">Stores results in <code>detectedObjects</code> JSON field</li>
<li class="">Updates job status to complete</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=deployment>Deployment<a href=#deployment class=hash-link aria-label="Direct link to Deployment" title="Direct link to Deployment" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=prerequisites>Prerequisites<a href=#prerequisites class=hash-link aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate=no>‚Äã</a></h3>
<ul>
<li class="">MySQL database for both services</li>
<li class="">AWS S3 bucket configured</li>
<li class="">Redis for job queue</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=migration-steps>Migration Steps<a href=#migration-steps class=hash-link aria-label="Direct link to Migration Steps" title="Direct link to Migration Steps" translate=no>‚Äã</a></h3>
<ol>
<li class=""><strong>Deploy swarm-api</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd swarm-api</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">just migrate-db-dev</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"># Applies: migrations/20251201025115_add_bottom_box_type.sql</span><br/></span></code></pre></div></div>
<ol start=2>
<li class=""><strong>Deploy image-splitter</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd image-splitter</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">just stop && just start</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"># Auto-runs: migrations/018-box-files.sql</span><br/></span></code></pre></div></div>
<ol start=3>
<li class=""><strong>Deploy web-app</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd web-app</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pnpm build</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"># Upload dist/ to hosting</span><br/></span></code></pre></div></div>
<ol start=4>
<li class=""><strong>Restart graphql-router</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">docker restart gratheon-graphql-router-1</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=verification>Verification<a href=#verification class=hash-link aria-label="Direct link to Verification" title="Direct link to Verification" translate=no>‚Äã</a></h3>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Check box type enum</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>SHOW</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>COLUMNS</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>FROM</span><span class="token plain"> boxes </span><span class="token operator" style=color:#393A34>LIKE</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'type'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Check files_box_rel table</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>DESCRIBE</span><span class="token plain"> files_box_rel</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Test data flow</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>INSERT</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>INTO</span><span class="token plain"> boxes </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">user_id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> hive_id</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> position</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>VALUES</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'BOTTOM'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Should return the box</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>FROM</span><span class="token plain"> boxes </span><span class="token keyword" style=color:#00009f>WHERE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'BOTTOM'</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=testing>Testing<a href=#testing class=hash-link aria-label="Direct link to Testing" title="Direct link to Testing" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=unit-tests>Unit Tests<a href=#unit-tests class=hash-link aria-label="Direct link to Unit Tests" title="Direct link to Unit Tests" translate=no>‚Äã</a></h3>
<p><strong>swarm-api</strong>:</p>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd swarm-api</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">go test ./...</span><br/></span></code></pre></div></div>
<p><strong>image-splitter</strong>:</p>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd image-splitter</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">npm test</span><br/></span></code></pre></div></div>
<p><strong>web-app</strong>:</p>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">cd web-app</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">pnpm test:unit</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=integration-test-flow>Integration Test Flow<a href=#integration-test-flow class=hash-link aria-label="Direct link to Integration Test Flow" title="Direct link to Integration Test Flow" translate=no>‚Äã</a></h3>
<ol>
<li class="">Create hive via API</li>
<li class="">Add BOTTOM box to hive</li>
<li class="">Upload image via BottomBox component</li>
<li class="">Verify:<!-- -->
<ul>
<li class="">File exists in S3</li>
<li class="">Record in <code>files</code> table</li>
<li class="">Record in <code>files_box_rel</code> table</li>
<li class="">Record in <code>files_hive_rel</code> table</li>
<li class="">Varroa job queued</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=manual-test>Manual Test<a href=#manual-test class=hash-link aria-label="Direct link to Manual Test" title="Direct link to Manual Test" translate=no>‚Äã</a></h3>
<ol>
<li class="">Navigate to hive in web-app</li>
<li class="">Click "Add bottom" button</li>
<li class="">Verify bottom box appears in structure</li>
<li class="">Click on bottom box</li>
<li class="">Upload image file</li>
<li class="">Check database:</li>
</ol>
<div class="language-sql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-sql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>SELECT</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>FROM</span><span class="token plain"> files_box_rel </span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>ORDER</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>BY</span><span class="token plain"> added_time </span><span class="token keyword" style=color:#00009f>DESC</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>LIMIT</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hash-link aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=common-issues>Common Issues<a href=#common-issues class=hash-link aria-label="Direct link to Common Issues" title="Direct link to Common Issues" translate=no>‚Äã</a></h3>
<p><strong>Issue</strong>: "Data truncated for column 'type'"</p>
<ul>
<li class=""><strong>Cause</strong>: Migration not run</li>
<li class=""><strong>Fix</strong>: Run <code>just migrate-db-dev</code> in swarm-api</li>
</ul>
<p><strong>Issue</strong>: "Unknown field addFileToBox"</p>
<ul>
<li class=""><strong>Cause</strong>: graphql-router not restarted</li>
<li class=""><strong>Fix</strong>: Restart graphql-router to reload schema</li>
</ul>
<p><strong>Issue</strong>: "Unable to resolve table files_box_rel"</p>
<ul>
<li class=""><strong>Cause</strong>: Migration not run in image-splitter</li>
<li class=""><strong>Fix</strong>: Rebuild image-splitter container</li>
</ul>
<p><strong>Issue</strong>: Image uploads but not linked</p>
<ul>
<li class=""><strong>Cause</strong>: Missing <code>addFileToBox</code> call</li>
<li class=""><strong>Fix</strong>: Check BottomBox component calls both mutations</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=future-enhancements>Future Enhancements<a href=#future-enhancements class=hash-link aria-label="Direct link to Future Enhancements" title="Direct link to Future Enhancements" translate=no>‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=phase-2-display-images>Phase 2: Display Images<a href=#phase-2-display-images class=hash-link aria-label="Direct link to Phase 2: Display Images" title="Direct link to Phase 2: Display Images" translate=no>‚Äã</a></h3>
<ul>
<li class="">Add query to fetch box images</li>
<li class="">Display images in UI</li>
<li class="">Show upload history</li>
<li class="">Image deletion capability</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=phase-3-varroa-detection>Phase 3: Varroa Detection<a href=#phase-3-varroa-detection class=hash-link aria-label="Direct link to Phase 3: Varroa Detection" title="Direct link to Phase 3: Varroa Detection" translate=no>‚Äã</a></h3>
<ul>
<li class="">Implement varroa counting model</li>
<li class="">Display count on images</li>
<li class="">Show detection regions</li>
<li class="">Confidence scores</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=phase-4-analytics>Phase 4: Analytics<a href=#phase-4-analytics class=hash-link aria-label="Direct link to Phase 4: Analytics" title="Direct link to Phase 4: Analytics" translate=no>‚Äã</a></h3>
<ul>
<li class="">Historical trend charts</li>
<li class="">Treatment correlation</li>
<li class="">Predictive alerts</li>
<li class="">Comparison across hives</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=related-documentation>Related Documentation<a href=#related-documentation class=hash-link aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate=no>‚Äã</a></h2>
<ul>
<li class="">[Bottom Board User Guide](../../about/products/web_app/starter-tier/üßÆ Hive bottom board & varroa monitoring.md)</li>
<li class="">[DB Schemas](./ü•û DB schemas/)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=change-log>Change Log<a href=#change-log class=hash-link aria-label="Direct link to Change Log" title="Direct link to Change Log" translate=no>‚Äã</a></h2>
<ul>
<li class=""><strong>2025-12-01</strong>: Initial implementation<!-- -->
<ul>
<li class="">Added BOTTOM box type</li>
<li class="">Created files_box_rel table</li>
<li class="">Implemented upload flow</li>
<li class="">Added BottomBox component</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_Za1t"><a href=https://github.com/gratheon/website/tree/main/packages/create-docusaurus/templates/shared/docs/web-app/features/bottom-board-management.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_RtZN aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_jlPf"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/web-app/features/timeseries-analytics><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Timeseries Data Analytics - Technical Documentation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/web-app/ü•û DB schemas/gate-video-stream"><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>gate-video-stream</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_y_d7 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#architecture class="table-of-contents__link toc-highlight">Architecture</a><ul><li><a href=#service-dependencies class="table-of-contents__link toc-highlight">Service Dependencies</a><li><a href=#data-flow class="table-of-contents__link toc-highlight">Data Flow</a></ul><li><a href=#database-schema class="table-of-contents__link toc-highlight">Database Schema</a><ul><li><a href=#swarm-api-schema class="table-of-contents__link toc-highlight">swarm-api Schema</a><li><a href=#image-splitter-schema class="table-of-contents__link toc-highlight">image-splitter Schema</a></ul><li><a href=#graphql-api class="table-of-contents__link toc-highlight">GraphQL API</a><ul><li><a href=#swarm-api class="table-of-contents__link toc-highlight">swarm-api</a><li><a href=#image-splitter class="table-of-contents__link toc-highlight">image-splitter</a></ul><li><a href=#frontend-implementation class="table-of-contents__link toc-highlight">Frontend Implementation</a><ul><li><a href=#bottombox-component class="table-of-contents__link toc-highlight">BottomBox Component</a><li><a href=#integration-points class="table-of-contents__link toc-highlight">Integration Points</a></ul><li><a href=#backend-implementation class="table-of-contents__link toc-highlight">Backend Implementation</a><ul><li><a href=#swarm-api-go class="table-of-contents__link toc-highlight">swarm-api (Go)</a><li><a href=#image-splitter-typescript class="table-of-contents__link toc-highlight">image-splitter (TypeScript)</a></ul><li><a href=#inspection-versioning class="table-of-contents__link toc-highlight">Inspection Versioning</a><ul><li><a href=#how-it-works class="table-of-contents__link toc-highlight">How It Works</a><li><a href=#sql-queries class="table-of-contents__link toc-highlight">SQL Queries</a></ul><li><a href=#job-queue-integration class="table-of-contents__link toc-highlight">Job Queue Integration</a><ul><li><a href=#varroa-detection-job class="table-of-contents__link toc-highlight">Varroa Detection Job</a></ul><li><a href=#deployment class="table-of-contents__link toc-highlight">Deployment</a><ul><li><a href=#prerequisites class="table-of-contents__link toc-highlight">Prerequisites</a><li><a href=#migration-steps class="table-of-contents__link toc-highlight">Migration Steps</a><li><a href=#verification class="table-of-contents__link toc-highlight">Verification</a></ul><li><a href=#testing class="table-of-contents__link toc-highlight">Testing</a><ul><li><a href=#unit-tests class="table-of-contents__link toc-highlight">Unit Tests</a><li><a href=#integration-test-flow class="table-of-contents__link toc-highlight">Integration Test Flow</a><li><a href=#manual-test class="table-of-contents__link toc-highlight">Manual Test</a></ul><li><a href=#troubleshooting class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href=#common-issues class="table-of-contents__link toc-highlight">Common Issues</a></ul><li><a href=#future-enhancements class="table-of-contents__link toc-highlight">Future Enhancements</a><ul><li><a href=#phase-2-display-images class="table-of-contents__link toc-highlight">Phase 2: Display Images</a><li><a href=#phase-3-varroa-detection class="table-of-contents__link toc-highlight">Phase 3: Varroa Detection</a><li><a href=#phase-4-analytics class="table-of-contents__link toc-highlight">Phase 4: Analytics</a></ul><li><a href=#related-documentation class="table-of-contents__link toc-highlight">Related Documentation</a><li><a href=#change-log class="table-of-contents__link toc-highlight">Change Log</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item>
                <a href=https://ariregister.rik.ee/est/company/12245103/Gratheon-O%C3%9C>Gratheon O√ú</a><br/>
                Tallinn, Estonia
              </ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/privacy>Privacy Policy</a><li class=footer__item><a class=footer__link-item href=/terms>Terms Of Service</a><li class=footer__item><a href=mailto:pilot@gratheon.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://tawk.to/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Support Chat<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gratheon.statuspage.io/ target=_blank rel="noopener noreferrer" class=footer__link-item>Service Status<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://t.me/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Telegram<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://www.linkedin.com/company/gratheon/ target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.facebook.com/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook</a><li class=footer__item><a href=https://www.twitch.tv/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Twitch</a><li class=footer__item><a href=https://www.youtube.com/@gratheon-bees target=_blank rel="noopener noreferrer" class=footer__link-item>Youtube<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><img src=/img/nvidia-inception-program-badge-rgb-for-screen.svg alt="NVIDIA Inception Program Member" style="max-width:200px; height: auto;"/></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright ¬© 2025 Gratheon O√ú. Gratheon‚Ñ¢ is a pending EU trademark.</div></div></div></footer></div></body>