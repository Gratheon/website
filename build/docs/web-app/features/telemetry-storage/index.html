<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-web-app/features/telemetry-storage" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Hive Telemetry Storage - Technical Documentation | Gratheon</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://gratheon.com/img/gratheon-web-app.webp /><meta data-rh=true name=twitter:image content=https://gratheon.com/img/gratheon-web-app.webp /><meta data-rh=true property=og:url content=https://gratheon.com/docs/web-app/features/telemetry-storage /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Hive Telemetry Storage - Technical Documentation | Gratheon"/><meta data-rh=true name=description content="üéØ Overview"/><meta data-rh=true property=og:description content="üéØ Overview"/><link data-rh=true rel=icon href=/favicons/favicon.ico /><link data-rh=true rel=canonical href=https://gratheon.com/docs/web-app/features/telemetry-storage /><link data-rh=true rel=alternate href=https://gratheon.com/docs/web-app/features/telemetry-storage hreflang=en /><link data-rh=true rel=alternate href=https://gratheon.com/docs/web-app/features/telemetry-storage hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://gratheon.com/docs/web-app/","name":"üì± Web-app","position":1},{"@type":"ListItem","item":"https://gratheon.com/docs/web-app/features/telemetry-storage","name":"Hive Telemetry Storage - Technical Documentation","position":2}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Gratheon RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Gratheon Atom Feed"><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-KH4KC9")</script><link rel=stylesheet href=/assets/css/styles.5035d0c0.css /><script src=/assets/js/runtime~main.93ee4b8a.js defer></script><script src=/assets/js/main.d7b5b1cd.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t;document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KH4KC9" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_poJ9 href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo_v7w.svg alt=Gratheon class="themedComponent_rn3I themedComponent--light_bBhh"/><img src=/img/logo_v7w.svg alt=Gratheon class="themedComponent_rn3I themedComponent--dark_zi9f"/></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href=/about>About</a><a class="navbar__item navbar__link" href=/about/products>Products</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/API/>Docs</a><a class="navbar__item navbar__link" sidebarid=researchSidebar href=/research>Research</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/pricing>Pricing</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class=navbarSearchContainer_rLJk><input type=text placeholder=Search style="padding:7px 15px;border:2px solid #CCC;border-radius:5px"/></div><a href=https://discord.gg/PcbP4uedWj target=_blank rel="noopener noreferrer" class="navbar__item navbar__link navbar--discord-link" aria-label="Discord Invite"></a><a href=https://github.com/gratheon/web-app target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header--github-link" aria-label="GitHub repository"></a><a href=https://app.gratheon.com/account/authenticate/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Log in<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_TcZ4"><div class=docsWrapper_a5BB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_jePA" type=button></button><div class=docRoot_YOz7><aside class="theme-doc-sidebar-container docSidebarContainer_PCNi"><div class=sidebarViewport_svvY><div class=sidebar_yZ0v><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_ib_h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/API/><span title="üîó API" class=categoryLinkLabel_dnDz>üîó API</span></a><button aria-label="Expand sidebar category 'üîó API'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--active" href=/docs/web-app/><span title="üì± Web-app" class=categoryLinkLabel_dnDz>üì± Web-app</span></a><button aria-label="Collapse sidebar category 'üì± Web-app'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/web-app/Tech stack, conventions, environments"><span title="Tech stack, conventions, environments" class=linkLabel_I9IG>Tech stack, conventions, environments</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/web-app/UX - UI wireframes"><span title="UX - UI wireframes" class=linkLabel_I9IG>UX - UI wireframes</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/docs/web-app/features/split-colony><span title=features class=categoryLinkLabel_dnDz>features</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/split-colony><span title="Split Colony - Technical Documentation" class=linkLabel_I9IG>Split Colony - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/join-colonies><span title="Join Colonies - Technical Documentation" class=linkLabel_I9IG>Join Colonies - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/frame-photo-upload><span title="Frame Photo Upload - Technical Documentation" class=linkLabel_I9IG>Frame Photo Upload - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/apiary-management><span title="Apiary Management - Technical Documentation" class=linkLabel_I9IG>Apiary Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/queen-detection><span title="Queen Detection - Technical Documentation" class=linkLabel_I9IG>Queen Detection - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/queen-management><span title="Queen Management - Technical Documentation" class=linkLabel_I9IG>Queen Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/frame-side-management><span title="Frame Side Management - Technical Documentation" class=linkLabel_I9IG>Frame Side Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/hive-management><span title="Hive Management - Technical Documentation" class=linkLabel_I9IG>Hive Management - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/user-registration><span title="User Registration - Technical Documentation" class=linkLabel_I9IG>User Registration - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/user-profile-editing><span title="User Profile Editing - Technical Documentation" class=linkLabel_I9IG>User Profile Editing - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/web-app/features/telemetry-storage><span title="Hive Telemetry Storage - Technical Documentation" class=linkLabel_I9IG>Hive Telemetry Storage - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/timeseries-analytics><span title="Timeseries Data Analytics - Technical Documentation" class=linkLabel_I9IG>Timeseries Data Analytics - Technical Documentation</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/web-app/features/bottom-board-management><span title=bottom-board-management class=linkLabel_I9IG>bottom-board-management</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href="/docs/web-app/ü•û DB schemas/gate-video-stream"><span title="ü•û DB schemas" class=categoryLinkLabel_dnDz>ü•û DB schemas</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/beehive-sensors/><span title="üå°Ô∏è Beehive IoT sensors" class=categoryLinkLabel_dnDz>üå°Ô∏è Beehive IoT sensors</span></a><button aria-label="Expand sidebar category 'üå°Ô∏è Beehive IoT sensors'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/entrance-observer/><span title="üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer" class=categoryLinkLabel_dnDz>üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer</span></a><button aria-label="Expand sidebar category 'üëÅÔ∏è‚Äçüó®Ô∏è Entrance observer'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_rikP menu__link menu__link--sublist" href=/docs/robotic-beehive/><span title="üßø Robotic beehive" class=categoryLinkLabel_dnDz>üßø Robotic beehive</span></a><button aria-label="Expand sidebar category 'üßø Robotic beehive'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href=https://github.com/orgs/Gratheon/projects/5 target=_blank rel="noopener noreferrer" class="menu__link menuExternalLink_FdF6"><span title="‚òëÔ∏è Tasks" class=linkLabel_I9IG>‚òëÔ∏è Tasks</span><svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></nav></div></div></aside><main class=docMainContainer_aHOd><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_BJgu"><div class=docItemContainer_PUtD><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_dpnR" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon__OJg><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/docs/web-app/><span>üì± Web-app</span></a><li class=breadcrumbs__item><span class=breadcrumbs__link>features</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Hive Telemetry Storage - Technical Documentation</span></ul></nav><div class="tocCollapsible_RHmT theme-doc-toc-mobile tocMobile_VHIv"><button type=button class="clean-btn tocCollapsibleButton_POOD">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hive Telemetry Storage - Technical Documentation</h1></header>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-overview>üéØ Overview<a href=#-overview class=hash-link aria-label="Direct link to üéØ Overview" title="Direct link to üéØ Overview" translate=no>‚Äã</a></h3>
<p>Time-series data storage and querying system for IoT sensor metrics from beehives. Handles ingestion from multiple device types (temperature/humidity sensors, weight scales, entrance cameras) and provides GraphQL/REST APIs for data retrieval with flexible time-range queries and aggregation functions.</p>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=Ô∏è-architecture>üèóÔ∏è Architecture<a href=#Ô∏è-architecture class=hash-link aria-label="Direct link to üèóÔ∏è Architecture" title="Direct link to üèóÔ∏è Architecture" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=components>Components<a href=#components class=hash-link aria-label="Direct link to Components" title="Direct link to Components" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>TelemetryChart</strong>: React component for rendering time-series graphs</li>
<li class=""><strong>MetricSelector</strong>: UI for choosing which metrics to display</li>
<li class=""><strong>TimeRangeFilter</strong>: Date range picker for historical queries</li>
<li class=""><strong>HiveTelemetryPanel</strong>: Dashboard widget showing real-time sensor data</li>
<li class=""><strong>GrafanaEmbed</strong>: iFrame integration for advanced analytics</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=services>Services<a href=#services class=hash-link aria-label="Direct link to Services" title="Direct link to Services" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>telemetry-api</strong>: Core service for metric storage and retrieval</li>
<li class=""><strong>beehive-sensors</strong>: Hardware device sending temperature, humidity, weight data</li>
<li class=""><strong>entrance-observer</strong>: Video analytics service sending bee traffic metrics</li>
<li class=""><strong>user-cycle</strong>: Authentication service for API token validation</li>
<li class=""><strong>graphql-router</strong>: Federated gateway routing telemetry queries</li>
<li class=""><strong>grafana</strong>: Advanced visualization and analytics platform</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-technical-specifications>üìã Technical Specifications<a href=#-technical-specifications class=hash-link aria-label="Direct link to üìã Technical Specifications" title="Direct link to üìã Technical Specifications" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=database-schema>Database Schema<a href=#database-schema class=hash-link aria-label="Direct link to Database Schema" title="Direct link to Database Schema" translate=no>‚Äã</a></h4>
<!-- -->
<p><strong>Table Design Rationale:</strong></p>
<ul>
<li class="">Separate tables for different metric categories (environmental vs entrance traffic)</li>
<li class="">Millisecond precision timestamps for high-frequency data</li>
<li class="">Composite indexes on (hive_id, timestamp DESC) for time-range queries</li>
<li class="">Indexes on (user_id, hive_id) for data isolation</li>
<li class="">Indexes on (metric_type, timestamp DESC) for filtered queries</li>
<li class="">device_id tracks data source for debugging</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=graphql-api>GraphQL API<a href=#graphql-api class=hash-link aria-label="Direct link to GraphQL API" title="Direct link to GraphQL API" translate=no>‚Äã</a></h4>
<div class="language-graphql codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-graphql codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>scalar</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>enum</span><span class="token plain"> </span><span class="token class-name">AggregationType</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token constant" style=color:#36acaa>DAILY_AVG</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token constant" style=color:#36acaa>DAILY_MAX</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token constant" style=color:#36acaa>DAILY_MIN</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">TelemetryError</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>message</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>code</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">MetricFloat</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>t</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>v</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">MetricFloatList</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>metrics</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token class-name">MetricFloat</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>union</span><span class="token plain"> </span><span class="token class-name">MetricListResult</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>MetricFloatList</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>TelemetryError</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">BeeMovementInOutResult</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beesIn</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beesOut</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>netFlow</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>avgSpeed</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>p95Speed</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>stationaryBees</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>detectedBees</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beeInteractions</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>time</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">EntranceMovementRecord</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>id</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>boxId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beesOut</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beesIn</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>time</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>netFlow</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>avgSpeed</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>p95Speed</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>stationaryBees</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>detectedBees</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>beeInteractions</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">EntranceMovementList</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>metrics</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token class-name">EntranceMovementRecord</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>union</span><span class="token plain"> </span><span class="token class-name">EntranceMovementResult</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>EntranceMovementList</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>TelemetryError</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>input</span><span class="token plain"> </span><span class="token atom-input class-name">MetricSetInput</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>temperatureCelsius</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>humidityPercent</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>weightKg</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Float</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">AddMetricMessage</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>message</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">String</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>union</span><span class="token plain"> </span><span class="token class-name">AddMetricResult</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>AddMetricMessage</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>TelemetryError</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">Query</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>temperatureCelsius</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>timeRangeMin</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">MetricListResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>humidityPercent</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>timeRangeMin</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">MetricListResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>weightKg</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>timeRangeMin</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">MetricListResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>weightKgAggregated</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>days</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">Int</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>aggregation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">AggregationType</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">MetricListResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>entranceMovementToday</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>boxId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">BeeMovementInOutResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>entranceMovement</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>boxId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>timeFrom</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>timeTo</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">DateTime</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">EntranceMovementResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>type</span><span class="token plain"> </span><span class="token class-name">Mutation</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token attr-name" style=color:#00a4db>addMetric</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>hiveId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token scalar">ID</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token attr-name" style=color:#00a4db>fields</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token atom-input class-name">MetricSetInput</span><span class="token operator" style=color:#393A34>!</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token class-name">AddMetricResult</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Design Notes:</strong></p>
<ul>
<li class="">Short field names (t, v) in MetricFloat to reduce payload size</li>
<li class="">Union types for error handling</li>
<li class="">Flexible time range (minutes ago) vs absolute timestamps</li>
<li class="">Aggregation at query time for flexibility</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=rest-api-endpoints>REST API Endpoints<a href=#rest-api-endpoints class=hash-link aria-label="Direct link to REST API Endpoints" title="Direct link to REST API Endpoints" translate=no>‚Äã</a></h4>
<div class="language-text codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-text codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">POST /v1/metrics/:hiveId</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">Body: {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "temperatureCelsius": 34.5,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "humidityPercent": 65.2,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "weightKg": 45.3</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">Headers: {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "Authorization": "Bearer &lt;user_api_token>"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">POST /v1/entrance/:hiveId/:boxId</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">Body: {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "beesIn": 12.5,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "beesOut": 10.2,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "netFlow": 2.3,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "avgSpeed": 1.2,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "p95Speed": 2.5,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "stationaryBees": 5,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "detectedBees": 18,</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "beeInteractions": 3</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">Headers: {</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  "Authorization": "Bearer &lt;device_token>"</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">GET /v1/metrics/:hiveId/temperature?from=2024-12-01&to=2024-12-06</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">GET /v1/metrics/:hiveId/humidity?minutes=60</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">GET /v1/metrics/:hiveId/weight?days=7&aggregation=DAILY_AVG</span><br/></span></code></pre></div></div>
<p><strong>REST Design:</strong></p>
<ul>
<li class="">Version prefix (/v1) for backwards compatibility</li>
<li class="">Token-based authentication via user-cycle</li>
<li class="">Support for both absolute timestamps and relative time ranges</li>
<li class="">Bulk insert capability for batched sensor data</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-implementation-details>üîß Implementation Details<a href=#-implementation-details class=hash-link aria-label="Direct link to üîß Implementation Details" title="Direct link to üîß Implementation Details" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=frontend-web-app>Frontend (web-app)<a href=#frontend-web-app class=hash-link aria-label="Direct link to Frontend (web-app)" title="Direct link to Frontend (web-app)" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>Framework</strong>: React 18 with TypeScript</li>
<li class=""><strong>Charting Library</strong>: Lightweight Charts by TradingView</li>
<li class=""><strong>State Management</strong>: Apollo Client for GraphQL caching</li>
<li class=""><strong>Real-time Updates</strong>: Polling every 30 seconds for live data</li>
<li class=""><strong>Data Formatting</strong>: Custom hooks for metric transformation</li>
</ul>
<p><strong>Key Components:</strong></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>interface</span><span class="token plain"> </span><span class="token class-name">TelemetryChartProps</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  hiveId</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  metricType</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'temperature'</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'humidity'</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'weight'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  timeRangeMinutes</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  aggregation</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> AggregationType</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> TelemetryChart</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> React</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>FC</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">TelemetryChartProps</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  metricType</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  timeRangeMinutes </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>60</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  aggregation</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> loading</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> error </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>useQuery</span><span class="token punctuation" style=color:#393A34>(</span><span class="token constant" style=color:#36acaa>GET_METRIC_QUERY</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    variables</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> timeRangeMin</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> timeRangeMinutes </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    pollInterval</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>30000</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">LineChart data</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">data</span><span class="token operator" style=color:#393A34>?.</span><span class="token plain">metrics</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=backend-telemetry-api>Backend (telemetry-api)<a href=#backend-telemetry-api class=hash-link aria-label="Direct link to Backend (telemetry-api)" title="Direct link to Backend (telemetry-api)" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>Language</strong>: Node.js with TypeScript</li>
<li class=""><strong>Framework</strong>: Apollo Server for GraphQL</li>
<li class=""><strong>Database</strong>: MySQL 8.0 with time-series optimizations</li>
<li class=""><strong>Authentication</strong>: JWT token validation via user-cycle</li>
<li class=""><strong>Rate Limiting</strong>: 100 req/min per device, 60 req/min per user</li>
</ul>
<p><strong>Data Ingestion Flow:</strong></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>addMetric</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  hiveId</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  userId</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  fields</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> MetricSetInput</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  deviceId</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token keyword" style=color:#00009f>void</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> timestamp </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> insertPromises </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">fields</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">temperatureCelsius </span><span class="token operator" style=color:#393A34>!==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>undefined</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    insertPromises</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">telemetry_metrics</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>insert</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        hive_id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        user_id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> userId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        metric_type</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'temperature'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        value</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> fields</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">temperatureCelsius</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        timestamp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        device_id</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> deviceId</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>all</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">insertPromises</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Query Optimization:</strong></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getTemperature</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  hiveId</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  timeRangeMin</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>60</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">MetricFloat</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> fromTime </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Date</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>now</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token plain"> timeRangeMin </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>60</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>query</span><span class="token punctuation" style=color:#393A34>(</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c></span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    SELECT </span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      timestamp as t,</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      value as v</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    FROM telemetry_metrics</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    WHERE hive_id = ? </span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      AND metric_type = 'temperature'</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      AND timestamp >= ?</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    ORDER BY timestamp ASC</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    LIMIT 10000</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>  </span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fromTime</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<p><strong>Aggregation Logic:</strong></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getWeightAggregated</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  hiveId</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  days</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  aggregation</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> AggregationType</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">MetricFloat</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> aggFunc </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token constant" style=color:#36acaa>DAILY_AVG</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'AVG'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token constant" style=color:#36acaa>DAILY_MAX</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'MAX'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token constant" style=color:#36acaa>DAILY_MIN</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'MIN'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">aggregation</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> db</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>query</span><span class="token punctuation" style=color:#393A34>(</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c></span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    SELECT </span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      DATE(timestamp) as t,</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      </span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">aggFunc</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string string" style=color:#e3116c>(value) as v</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    FROM telemetry_metrics</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    WHERE hive_id = ?</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      AND metric_type = 'weight'</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>      AND timestamp >= DATE_SUB(NOW(), INTERVAL ? DAY)</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    GROUP BY DATE(timestamp)</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>    ORDER BY t ASC</span><br/></span><span class=token-line style=color:#393A34><span class="token template-string string" style=color:#e3116c>  </span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> days</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=data-flow>Data Flow<a href=#data-flow class=hash-link aria-label="Direct link to Data Flow" title="Direct link to Data Flow" translate=no>‚Äã</a></h4>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=Ô∏è-configuration>‚öôÔ∏è Configuration<a href=#Ô∏è-configuration class=hash-link aria-label="Direct link to ‚öôÔ∏è Configuration" title="Direct link to ‚öôÔ∏è Configuration" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=environment-variables-telemetry-api>Environment Variables (telemetry-api)<a href=#environment-variables-telemetry-api class=hash-link aria-label="Direct link to Environment Variables (telemetry-api)" title="Direct link to Environment Variables (telemetry-api)" translate=no>‚Äã</a></h4>
<div class="language-bash codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-bash codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">MYSQL_HOST=localhost</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">MYSQL_PORT=3306</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">MYSQL_USER=telemetry</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">MYSQL_PASSWORD=secret</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">MYSQL_DATABASE=gratheon</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">USER_CYCLE_URL=http://user-cycle:8080</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">GRAPHQL_ROUTER_URL=http://graphql-router:8080</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">RATE_LIMIT_DEVICE=100</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">RATE_LIMIT_USER=60</span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">DATA_RETENTION_DAYS_HOBBYIST=365</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">DATA_RETENTION_DAYS_STARTER=730</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">DATA_RETENTION_DAYS_PRO=1095</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=device-configuration-beehive-sensors>Device Configuration (beehive-sensors)<a href=#device-configuration-beehive-sensors class=hash-link aria-label="Direct link to Device Configuration (beehive-sensors)" title="Direct link to Device Configuration (beehive-sensors)" translate=no>‚Äã</a></h4>
<div class="language-ini codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-ini codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token plain">[telemetry]</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">api_endpoint=https://telemetry.gratheon.com/v1/metrics</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">api_token=your_api_token_here</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">hive_id=123</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">interval_seconds=5</span><br/></span><span class=token-line style=color:#393A34><span class="token plain">batch_size=12</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-testing>üß™ Testing<a href=#-testing class=hash-link aria-label="Direct link to üß™ Testing" title="Direct link to üß™ Testing" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=unit-tests>Unit Tests<a href=#unit-tests class=hash-link aria-label="Direct link to Unit Tests" title="Direct link to Unit Tests" translate=no>‚Äã</a></h4>
<p>Location: <code>/test/unit/</code></p>
<p><strong>Coverage:</strong></p>
<ul>
<li class="">Metric ingestion validation (required fields, data types)</li>
<li class="">Time range query logic (relative and absolute)</li>
<li class="">Aggregation calculations (avg, min, max)</li>
<li class="">Error handling (invalid hive IDs, unauthorized access)</li>
</ul>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token function" style=color:#d73a49>describe</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'TelemetryAPI'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>describe</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'addMetric'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>it</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'should insert temperature metric'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> result </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>addMetric</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> userId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        temperatureCelsius</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>34.5</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toBeDefined</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>it</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'should reject invalid temperature values'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>expect</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token function" style=color:#d73a49>addMetric</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">hiveId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> userId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> temperatureCelsius</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>150</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">rejects</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>toThrow</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'Invalid temperature range'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=integration-tests>Integration Tests<a href=#integration-tests class=hash-link aria-label="Direct link to Integration Tests" title="Direct link to Integration Tests" translate=no>‚Äã</a></h4>
<p>Location: <code>/test/integration/</code></p>
<p><strong>Scenarios:</strong></p>
<ul>
<li class="">End-to-end data flow from device to database</li>
<li class="">GraphQL query response format validation</li>
<li class="">Token authentication with user-cycle</li>
<li class="">Rate limiting enforcement</li>
<li class="">Data retention policy execution</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=e2e-tests>E2E Tests<a href=#e2e-tests class=hash-link aria-label="Direct link to E2E Tests" title="Direct link to E2E Tests" translate=no>‚Äã</a></h4>
<p>Location: <code>web-app/e2e/telemetry.spec.ts</code></p>
<p><strong>User Flows:</strong></p>
<ul>
<li class="">View real-time sensor data on hive dashboard</li>
<li class="">Query historical data with time range selector</li>
<li class="">Export telemetry data as CSV</li>
<li class="">Set up threshold alerts based on metrics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-performance-considerations>üìä Performance Considerations<a href=#-performance-considerations class=hash-link aria-label="Direct link to üìä Performance Considerations" title="Direct link to üìä Performance Considerations" translate=no>‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=optimizations>Optimizations<a href=#optimizations class=hash-link aria-label="Direct link to Optimizations" title="Direct link to Optimizations" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>Database Indexes</strong>: Composite indexes on (hive_id, timestamp) for fast range queries</li>
<li class=""><strong>Query Caching</strong>: Apollo Server caching for frequently accessed time ranges (5 min TTL)</li>
<li class=""><strong>Connection Pooling</strong>: MySQL connection pool (min: 10, max: 100)</li>
<li class=""><strong>Batch Inserts</strong>: Group multiple metrics from same device into single transaction</li>
<li class=""><strong>Query Limits</strong>: Maximum 10,000 data points per query to prevent memory issues</li>
<li class=""><strong>Aggregation</strong>: Pre-calculate daily aggregates for long time ranges (over 30 days)</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=bottlenecks>Bottlenecks<a href=#bottlenecks class=hash-link aria-label="Direct link to Bottlenecks" title="Direct link to Bottlenecks" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>High-frequency writes</strong>: Sensors send data every 5 seconds, approximately 17,280 inserts per hive per day</li>
<li class=""><strong>Large time-range queries</strong>: Queries over 1 year require aggregation to avoid memory issues</li>
<li class=""><strong>Concurrent device writes</strong>: MySQL write locks during bulk inserts from multiple devices</li>
<li class=""><strong>Grafana load</strong>: Complex dashboard queries can generate 20+ database queries simultaneously</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_rb2N" id=metrics>Metrics<a href=#metrics class=hash-link aria-label="Direct link to Metrics" title="Direct link to Metrics" translate=no>‚Äã</a></h4>
<ul>
<li class=""><strong>Query response time</strong>: under 500ms for 24-hour range, under 2 seconds for 30-day range</li>
<li class=""><strong>Write throughput</strong>: over 1000 metrics per second across all devices</li>
<li class=""><strong>Database size</strong>: approximately 500MB per hive per year (raw metrics)</li>
<li class=""><strong>Success rate</strong>: over 99.5% (excluding network failures)</li>
<li class=""><strong>API availability</strong>: over 99.9% uptime (monitored via health checks)</li>
</ul>
<p><strong>Performance Monitoring:</strong></p>
<div class="language-typescript codeBlockContainer_InFo theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_zYTH><pre tabindex=0 class="prism-code language-typescript codeBlock_Qx6K thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_VjvH><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>interface</span><span class="token plain"> </span><span class="token class-name">PerformanceMetrics</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  queryDuration</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  dataPoints</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  cacheHit</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  dbConnectionTime</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>logQueryPerformance</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  operation</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  metrics</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> PerformanceMetrics</span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">metrics</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">queryDuration </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2000</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">    logger</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>warn</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'Slow query detected'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> operation</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> metrics </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-technical-limitations>üö´ Technical Limitations<a href=#-technical-limitations class=hash-link aria-label="Direct link to üö´ Technical Limitations" title="Direct link to üö´ Technical Limitations" translate=no>‚Äã</a></h3>
<p><strong>Current Constraints:</strong></p>
<ul>
<li class="">Maximum query range: 2 years without aggregation</li>
<li class="">Data point limit per query: 10,000 records</li>
<li class="">Write frequency: minimum 1 second interval per device</li>
<li class="">Supported metrics: temperature, humidity, weight, entrance traffic only</li>
<li class="">No real-time websocket streaming (polling only)</li>
<li class="">Grafana requires separate authentication (not SSO integrated)</li>
</ul>
<p><strong>Known Issues:</strong></p>
<ul>
<li class="">Daylight saving time transitions can create timestamp gaps in charts</li>
<li class="">Device clock drift can cause out-of-order inserts</li>
<li class="">MySQL date partitioning not yet implemented (planned for high-volume users)</li>
<li class="">No automatic outlier detection or data smoothing</li>
<li class="">Entrance traffic metrics require box_id (not hive-level aggregation)</li>
</ul>
<p><strong>Future Improvements:</strong></p>
<ul>
<li class="">Add support for CO2, pressure, audio, vibration sensors</li>
<li class="">Implement websocket subscriptions for real-time updates</li>
<li class="">Add predictive analytics and anomaly detection</li>
<li class="">Create automated report generation</li>
<li class="">Implement data compression for older metrics (over 1 year)</li>
<li class="">Add multi-hive aggregation queries for apiary-level analytics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-related-documentation>üîó Related Documentation<a href=#-related-documentation class=hash-link aria-label="Direct link to üîó Related Documentation" title="Direct link to üîó Related Documentation" translate=no>‚Äã</a></h3>
<ul>
<li class=""><a class="" href=/about/products/web_app/pro-tier/hive_telemetry_storage>Hive Telemetry Storage (User Guide)</a></li>
<li class=""><a class="" href=/about/products/web_app/flexible-tier/alerts>Alert Management</a></li>
<li class=""><a class="" href=/about/products/web_app/pro-tier/colony_comparison_analytics>Colony Comparison Analytics</a></li>
<li class=""><a class="" href=/docs/API/GraphQL>GraphQL API Reference</a></li>
<li class=""><a class="" href=/docs/API/REST>REST API Reference</a></li>
<li class=""><a class="" href=/docs/API/Authentication>Authentication Guide</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-development-resources>üìö Development Resources<a href=#-development-resources class=hash-link aria-label="Direct link to üìö Development Resources" title="Direct link to üìö Development Resources" translate=no>‚Äã</a></h3>
<ul>
<li class=""><strong>GitHub Repository</strong>: <a href=https://github.com/Gratheon/telemetry-api target=_blank rel="noopener noreferrer" class="">telemetry-api</a></li>
<li class=""><strong>Architecture Diagram</strong>: Available in repository README</li>
<li class=""><strong>API Schema</strong>: <code>/schema.graphql</code> in repository</li>
<li class=""><strong>Database Migrations</strong>: <code>/migrations</code> directory</li>
<li class=""><strong>Grafana Dashboards</strong>: <code>/grafana/dashboards</code> (JSON exports)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_rb2N" id=-technical-notes>üí¨ Technical Notes<a href=#-technical-notes class=hash-link aria-label="Direct link to üí¨ Technical Notes" title="Direct link to üí¨ Technical Notes" translate=no>‚Äã</a></h3>
<p><strong>Implementation Decisions:</strong></p>
<ul>
<li class="">Chose MySQL over InfluxDB/ClickHouse to reduce operational complexity (single database engine)</li>
<li class="">REST API maintained for legacy device compatibility (new devices should use GraphQL)</li>
<li class="">Polling instead of websockets for simpler scaling and lower server resource usage</li>
<li class="">Separate table for entrance traffic due to different schema (multiple metrics per timestamp)</li>
<li class="">Short field names (t, v) in GraphQL responses to optimize mobile data usage</li>
</ul>
<p><strong>Integration Considerations:</strong></p>
<ul>
<li class="">Devices must handle network interruptions gracefully (buffer and retry)</li>
<li class="">API tokens should be rotated every 90 days for security</li>
<li class="">Large time-range queries should use aggregation to prevent timeout</li>
<li class="">Grafana embedding requires CORS configuration on telemetry-api</li>
<li class="">Data retention policies executed daily via cron job (deletes old records)</li>
</ul>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_rb2N" id=change-log>Change Log<a href=#change-log class=hash-link aria-label="Direct link to Change Log" title="Direct link to Change Log" translate=no>‚Äã</a></h2>
<p><strong>Last Updated</strong>: December 6, 2025</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_Za1t"><a href=https://github.com/gratheon/website/tree/main/packages/create-docusaurus/templates/shared/docs/web-app/features/telemetry-storage.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_RtZN aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_jlPf"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/web-app/features/user-profile-editing><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>User Profile Editing - Technical Documentation</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/web-app/features/timeseries-analytics><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Timeseries Data Analytics - Technical Documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_y_d7 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#-overview class="table-of-contents__link toc-highlight">üéØ Overview</a><li><a href=#Ô∏è-architecture class="table-of-contents__link toc-highlight">üèóÔ∏è Architecture</a><li><a href=#-technical-specifications class="table-of-contents__link toc-highlight">üìã Technical Specifications</a><li><a href=#-implementation-details class="table-of-contents__link toc-highlight">üîß Implementation Details</a><li><a href=#Ô∏è-configuration class="table-of-contents__link toc-highlight">‚öôÔ∏è Configuration</a><li><a href=#-testing class="table-of-contents__link toc-highlight">üß™ Testing</a><li><a href=#-performance-considerations class="table-of-contents__link toc-highlight">üìä Performance Considerations</a><li><a href=#-technical-limitations class="table-of-contents__link toc-highlight">üö´ Technical Limitations</a><li><a href=#-related-documentation class="table-of-contents__link toc-highlight">üîó Related Documentation</a><li><a href=#-development-resources class="table-of-contents__link toc-highlight">üìö Development Resources</a><li><a href=#-technical-notes class="table-of-contents__link toc-highlight">üí¨ Technical Notes</a><li><a href=#change-log class="table-of-contents__link toc-highlight">Change Log</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item>
                <a href=https://ariregister.rik.ee/est/company/12245103/Gratheon-O%C3%9C>Gratheon O√ú</a><br/>
                Tallinn, Estonia
              </ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/privacy>Privacy Policy</a><li class=footer__item><a class=footer__link-item href=/terms>Terms Of Service</a><li class=footer__item><a href=mailto:pilot@gratheon.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://tawk.to/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Support Chat<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gratheon.statuspage.io/ target=_blank rel="noopener noreferrer" class=footer__link-item>Service Status<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://t.me/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Telegram<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://twitter.com/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://www.linkedin.com/company/gratheon/ target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.facebook.com/gratheon target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook</a><li class=footer__item><a href=https://www.twitch.tv/tot_ra target=_blank rel="noopener noreferrer" class=footer__link-item>Twitch</a><li class=footer__item><a href=https://www.youtube.com/@gratheon-bees target=_blank rel="noopener noreferrer" class=footer__link-item>Youtube<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_c9sx><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><img src=/img/nvidia-inception-program-badge-rgb-for-screen.svg alt="NVIDIA Inception Program Member" style="max-width:200px; height: auto;"/></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright ¬© 2025 Gratheon O√ú. Gratheon‚Ñ¢ is a pending EU trademark.</div></div></div></footer></div></body>