"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["89027"],{30869(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>a,contentTitle:()=>l,toc:()=>o,assets:()=>c});var t=JSON.parse('{"id":"web-app/features/telemetry-storage","title":"Hive Telemetry Storage - Technical Documentation","description":"\u{1F3AF} Overview","source":"@site/docs/web-app/features/telemetry-storage.md","sourceDirName":"web-app/features","slug":"/web-app/features/telemetry-storage","permalink":"/docs/web-app/features/telemetry-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/gratheon/website/tree/main/packages/create-docusaurus/templates/shared/docs/web-app/features/telemetry-storage.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"User Profile Editing - Technical Documentation","permalink":"/docs/web-app/features/user-profile-editing"},"next":{"title":"Timeseries Data Analytics - Technical Documentation","permalink":"/docs/web-app/features/timeseries-analytics"}}'),r=i(86070),s=i(18439);let a={sidebar_position:12},l="Hive Telemetry Storage - Technical Documentation",c={},o=[{value:"\u{1F3AF} Overview",id:"-overview",level:3},{value:"\u{1F3D7}\uFE0F Architecture",id:"\uFE0F-architecture",level:3},{value:"Components",id:"components",level:4},{value:"Services",id:"services",level:4},{value:"\u{1F4CB} Technical Specifications",id:"-technical-specifications",level:3},{value:"Database Schema",id:"database-schema",level:4},{value:"GraphQL API",id:"graphql-api",level:4},{value:"REST API Endpoints",id:"rest-api-endpoints",level:4},{value:"\u{1F527} Implementation Details",id:"-implementation-details",level:3},{value:"Frontend (web-app)",id:"frontend-web-app",level:4},{value:"Backend (telemetry-api)",id:"backend-telemetry-api",level:4},{value:"Data Flow",id:"data-flow",level:4},{value:"\u2699\uFE0F Configuration",id:"\uFE0F-configuration",level:3},{value:"Environment Variables (telemetry-api)",id:"environment-variables-telemetry-api",level:4},{value:"Device Configuration (beehive-sensors)",id:"device-configuration-beehive-sensors",level:4},{value:"\u{1F9EA} Testing",id:"-testing",level:3},{value:"Unit Tests",id:"unit-tests",level:4},{value:"Integration Tests",id:"integration-tests",level:4},{value:"E2E Tests",id:"e2e-tests",level:4},{value:"\u{1F4CA} Performance Considerations",id:"-performance-considerations",level:3},{value:"Optimizations",id:"optimizations",level:4},{value:"Bottlenecks",id:"bottlenecks",level:4},{value:"Metrics",id:"metrics",level:4},{value:"\u{1F6AB} Technical Limitations",id:"-technical-limitations",level:3},{value:"\u{1F517} Related Documentation",id:"-related-documentation",level:3},{value:"\u{1F4DA} Development Resources",id:"-development-resources",level:3},{value:"\u{1F4AC} Technical Notes",id:"-technical-notes",level:3},{value:"Change Log",id:"change-log",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"hive-telemetry-storage---technical-documentation",children:"Hive Telemetry Storage - Technical Documentation"})}),"\n",(0,r.jsx)(n.h3,{id:"-overview",children:"\u{1F3AF} Overview"}),"\n",(0,r.jsx)(n.p,{children:"Time-series data storage and querying system for IoT sensor metrics from beehives. Handles ingestion from multiple device types (temperature/humidity sensors, weight scales, entrance cameras) and provides GraphQL/REST APIs for data retrieval with flexible time-range queries and aggregation functions."}),"\n",(0,r.jsx)(n.h3,{id:"\uFE0F-architecture",children:"\u{1F3D7}\uFE0F Architecture"}),"\n",(0,r.jsx)(n.h4,{id:"components",children:"Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TelemetryChart"}),": React component for rendering time-series graphs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MetricSelector"}),": UI for choosing which metrics to display"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TimeRangeFilter"}),": Date range picker for historical queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"HiveTelemetryPanel"}),": Dashboard widget showing real-time sensor data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GrafanaEmbed"}),": iFrame integration for advanced analytics"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"services",children:"Services"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"telemetry-api"}),": Core service for metric storage and retrieval"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"beehive-sensors"}),": Hardware device sending temperature, humidity, weight data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"entrance-observer"}),": Video analytics service sending bee traffic metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"user-cycle"}),": Authentication service for API token validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"graphql-router"}),": Federated gateway routing telemetry queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"grafana"}),": Advanced visualization and analytics platform"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-technical-specifications",children:"\u{1F4CB} Technical Specifications"}),"\n",(0,r.jsx)(n.h4,{id:"database-schema",children:"Database Schema"}),"\n",(0,r.jsx)(n.mermaid,{value:'erDiagram\n    users ||--o{ telemetry_metrics : "owns"\n    users ||--o{ entrance_traffic : "owns"\n    hives ||--o{ telemetry_metrics : "has"\n    hives ||--o{ entrance_traffic : "has"\n    boxes ||--o{ entrance_traffic : "monitors"\n    devices ||--o{ telemetry_metrics : "sends"\n    \n    telemetry_metrics {\n        bigint id PK\n        int hive_id FK\n        int user_id FK\n        enum metric_type "temperature, humidity, weight"\n        float value\n        datetime timestamp "millisecond precision"\n        varchar device_id FK "optional"\n    }\n    \n    entrance_traffic {\n        bigint id PK\n        int hive_id FK\n        int box_id FK\n        int user_id FK\n        float bees_in\n        float bees_out\n        float net_flow\n        float avg_speed\n        float p95_speed\n        int stationary_bees\n        int detected_bees\n        int bee_interactions\n        datetime timestamp "millisecond precision"\n    }\n    \n    users {\n        int id PK\n        varchar email\n    }\n    \n    hives {\n        int id PK\n        int user_id FK\n        varchar name\n    }\n    \n    boxes {\n        int id PK\n        int hive_id FK\n        enum type "DEEP, SUPER, GATE, BOTTOM"\n    }\n    \n    devices {\n        varchar device_id PK\n        int hive_id FK\n        enum type "sensor, camera"\n    }'}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Table Design Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Separate tables for different metric categories (environmental vs entrance traffic)"}),"\n",(0,r.jsx)(n.li,{children:"Millisecond precision timestamps for high-frequency data"}),"\n",(0,r.jsx)(n.li,{children:"Composite indexes on (hive_id, timestamp DESC) for time-range queries"}),"\n",(0,r.jsx)(n.li,{children:"Indexes on (user_id, hive_id) for data isolation"}),"\n",(0,r.jsx)(n.li,{children:"Indexes on (metric_type, timestamp DESC) for filtered queries"}),"\n",(0,r.jsx)(n.li,{children:"device_id tracks data source for debugging"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"graphql-api",children:"GraphQL API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"scalar DateTime\n\nenum AggregationType {\n  DAILY_AVG\n  DAILY_MAX\n  DAILY_MIN\n}\n\ntype TelemetryError {\n  message: String\n  code: String\n}\n\ntype MetricFloat {\n  t: DateTime!\n  v: Float\n}\n\ntype MetricFloatList {\n  metrics: [MetricFloat]\n}\n\nunion MetricListResult = MetricFloatList | TelemetryError\n\ntype BeeMovementInOutResult {\n  beesIn: Float\n  beesOut: Float\n  netFlow: Float\n  avgSpeed: Float\n  p95Speed: Float\n  stationaryBees: Int\n  detectedBees: Int\n  beeInteractions: Int\n  time: DateTime\n}\n\ntype EntranceMovementRecord {\n  id: ID!\n  hiveId: ID!\n  boxId: ID!\n  beesOut: Float\n  beesIn: Float\n  time: DateTime!\n  netFlow: Float\n  avgSpeed: Float\n  p95Speed: Float\n  stationaryBees: Int\n  detectedBees: Int\n  beeInteractions: Int\n}\n\ntype EntranceMovementList {\n  metrics: [EntranceMovementRecord]\n}\n\nunion EntranceMovementResult = EntranceMovementList | TelemetryError\n\ninput MetricSetInput {\n  temperatureCelsius: Float\n  humidityPercent: Float\n  weightKg: Float\n}\n\ntype AddMetricMessage {\n  message: String\n}\n\nunion AddMetricResult = AddMetricMessage | TelemetryError\n\ntype Query {\n  temperatureCelsius(\n    hiveId: ID!\n    timeRangeMin: Int\n  ): MetricListResult\n  \n  humidityPercent(\n    hiveId: ID!\n    timeRangeMin: Int\n  ): MetricListResult\n  \n  weightKg(\n    hiveId: ID!\n    timeRangeMin: Int\n  ): MetricListResult\n  \n  weightKgAggregated(\n    hiveId: ID!\n    days: Int!\n    aggregation: AggregationType\n  ): MetricListResult\n  \n  entranceMovementToday(\n    hiveId: ID!\n    boxId: ID!\n  ): BeeMovementInOutResult\n  \n  entranceMovement(\n    hiveId: ID!\n    boxId: ID\n    timeFrom: DateTime!\n    timeTo: DateTime!\n  ): EntranceMovementResult\n}\n\ntype Mutation {\n  addMetric(\n    hiveId: ID!\n    fields: MetricSetInput!\n  ): AddMetricResult\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Design Notes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Short field names (t, v) in MetricFloat to reduce payload size"}),"\n",(0,r.jsx)(n.li,{children:"Union types for error handling"}),"\n",(0,r.jsx)(n.li,{children:"Flexible time range (minutes ago) vs absolute timestamps"}),"\n",(0,r.jsx)(n.li,{children:"Aggregation at query time for flexibility"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"rest-api-endpoints",children:"REST API Endpoints"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'POST /v1/metrics/:hiveId\nBody: {\n  "temperatureCelsius": 34.5,\n  "humidityPercent": 65.2,\n  "weightKg": 45.3\n}\nHeaders: {\n  "Authorization": "Bearer <user_api_token>"\n}\n\nPOST /v1/entrance/:hiveId/:boxId\nBody: {\n  "beesIn": 12.5,\n  "beesOut": 10.2,\n  "netFlow": 2.3,\n  "avgSpeed": 1.2,\n  "p95Speed": 2.5,\n  "stationaryBees": 5,\n  "detectedBees": 18,\n  "beeInteractions": 3\n}\nHeaders: {\n  "Authorization": "Bearer <device_token>"\n}\n\nGET /v1/metrics/:hiveId/temperature?from=2024-12-01&to=2024-12-06\nGET /v1/metrics/:hiveId/humidity?minutes=60\nGET /v1/metrics/:hiveId/weight?days=7&aggregation=DAILY_AVG\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"REST Design:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Version prefix (/v1) for backwards compatibility"}),"\n",(0,r.jsx)(n.li,{children:"Token-based authentication via user-cycle"}),"\n",(0,r.jsx)(n.li,{children:"Support for both absolute timestamps and relative time ranges"}),"\n",(0,r.jsx)(n.li,{children:"Bulk insert capability for batched sensor data"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-implementation-details",children:"\u{1F527} Implementation Details"}),"\n",(0,r.jsx)(n.h4,{id:"frontend-web-app",children:"Frontend (web-app)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Framework"}),": React 18 with TypeScript"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Charting Library"}),": Lightweight Charts by TradingView"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"State Management"}),": Apollo Client for GraphQL caching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real-time Updates"}),": Polling every 30 seconds for live data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data Formatting"}),": Custom hooks for metric transformation"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Components:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface TelemetryChartProps {\n  hiveId: string;\n  metricType: 'temperature' | 'humidity' | 'weight';\n  timeRangeMinutes?: number;\n  aggregation?: AggregationType;\n}\n\nconst TelemetryChart: React.FC<TelemetryChartProps> = ({\n  hiveId,\n  metricType,\n  timeRangeMinutes = 60,\n  aggregation\n}) => {\n  const { data, loading, error } = useQuery(GET_METRIC_QUERY, {\n    variables: { hiveId, timeRangeMin: timeRangeMinutes },\n    pollInterval: 30000\n  });\n  \n  return <LineChart data={data?.metrics} />;\n};\n"})}),"\n",(0,r.jsx)(n.h4,{id:"backend-telemetry-api",children:"Backend (telemetry-api)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Language"}),": Node.js with TypeScript"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Framework"}),": Apollo Server for GraphQL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"}),": MySQL 8.0 with time-series optimizations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication"}),": JWT token validation via user-cycle"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate Limiting"}),": 100 req/min per device, 60 req/min per user"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Data Ingestion Flow:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async function addMetric(\n  hiveId: number,\n  userId: number,\n  fields: MetricSetInput,\n  deviceId?: string\n): Promise<void> {\n  const timestamp = new Date();\n  const insertPromises = [];\n  \n  if (fields.temperatureCelsius !== undefined) {\n    insertPromises.push(\n      db.telemetry_metrics.insert({\n        hive_id: hiveId,\n        user_id: userId,\n        metric_type: 'temperature',\n        value: fields.temperatureCelsius,\n        timestamp,\n        device_id: deviceId\n      })\n    );\n  }\n  \n  await Promise.all(insertPromises);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Query Optimization:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async function getTemperature(\n  hiveId: number,\n  timeRangeMin: number = 60\n): Promise<MetricFloat[]> {\n  const fromTime = new Date(Date.now() - timeRangeMin * 60 * 1000);\n  \n  return db.query(`\n    SELECT \n      timestamp as t,\n      value as v\n    FROM telemetry_metrics\n    WHERE hive_id = ? \n      AND metric_type = 'temperature'\n      AND timestamp >= ?\n    ORDER BY timestamp ASC\n    LIMIT 10000\n  `, [hiveId, fromTime]);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Aggregation Logic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async function getWeightAggregated(\n  hiveId: number,\n  days: number,\n  aggregation: AggregationType\n): Promise<MetricFloat[]> {\n  const aggFunc = {\n    DAILY_AVG: 'AVG',\n    DAILY_MAX: 'MAX',\n    DAILY_MIN: 'MIN'\n  }[aggregation];\n  \n  return db.query(`\n    SELECT \n      DATE(timestamp) as t,\n      ${aggFunc}(value) as v\n    FROM telemetry_metrics\n    WHERE hive_id = ?\n      AND metric_type = 'weight'\n      AND timestamp >= DATE_SUB(NOW(), INTERVAL ? DAY)\n    GROUP BY DATE(timestamp)\n    ORDER BY t ASC\n  `, [hiveId, days]);\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"data-flow",children:"Data Flow"}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant S as beehive-sensors\n    participant T as telemetry-api\n    participant U as user-cycle\n    participant M as MySQL\n    participant W as web-app\n    participant G as grafana\n    \n    S->>T: POST /v1/metrics (with token)\n    T->>U: Validate API token\n    U--\x3e>T: User ID & permissions\n    T->>M: INSERT telemetry_metrics\n    M--\x3e>T: Success\n    T--\x3e>S: 200 OK\n    \n    W->>T: GraphQL: temperatureCelsius\n    T->>M: SELECT FROM telemetry_metrics\n    M--\x3e>T: Time-series data\n    T--\x3e>W: MetricFloatList\n    \n    G->>M: Direct SQL query\n    M--\x3e>G: Aggregated results"}),"\n",(0,r.jsx)(n.h3,{id:"\uFE0F-configuration",children:"\u2699\uFE0F Configuration"}),"\n",(0,r.jsx)(n.h4,{id:"environment-variables-telemetry-api",children:"Environment Variables (telemetry-api)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"MYSQL_HOST=localhost\nMYSQL_PORT=3306\nMYSQL_USER=telemetry\nMYSQL_PASSWORD=secret\nMYSQL_DATABASE=gratheon\n\nUSER_CYCLE_URL=http://user-cycle:8080\nGRAPHQL_ROUTER_URL=http://graphql-router:8080\n\nRATE_LIMIT_DEVICE=100\nRATE_LIMIT_USER=60\n\nDATA_RETENTION_DAYS_HOBBYIST=365\nDATA_RETENTION_DAYS_STARTER=730\nDATA_RETENTION_DAYS_PRO=1095\n"})}),"\n",(0,r.jsx)(n.h4,{id:"device-configuration-beehive-sensors",children:"Device Configuration (beehive-sensors)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[telemetry]\napi_endpoint=https://telemetry.gratheon.com/v1/metrics\napi_token=your_api_token_here\nhive_id=123\ninterval_seconds=5\nbatch_size=12\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-testing",children:"\u{1F9EA} Testing"}),"\n",(0,r.jsx)(n.h4,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,r.jsxs)(n.p,{children:["Location: ",(0,r.jsx)(n.code,{children:"/test/unit/"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Coverage:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Metric ingestion validation (required fields, data types)"}),"\n",(0,r.jsx)(n.li,{children:"Time range query logic (relative and absolute)"}),"\n",(0,r.jsx)(n.li,{children:"Aggregation calculations (avg, min, max)"}),"\n",(0,r.jsx)(n.li,{children:"Error handling (invalid hive IDs, unauthorized access)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"describe('TelemetryAPI', () => {\n  describe('addMetric', () => {\n    it('should insert temperature metric', async () => {\n      const result = await addMetric(hiveId, userId, {\n        temperatureCelsius: 34.5\n      });\n      expect(result).toBeDefined();\n    });\n    \n    it('should reject invalid temperature values', async () => {\n      await expect(\n        addMetric(hiveId, userId, { temperatureCelsius: 150 })\n      ).rejects.toThrow('Invalid temperature range');\n    });\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h4,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,r.jsxs)(n.p,{children:["Location: ",(0,r.jsx)(n.code,{children:"/test/integration/"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenarios:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"End-to-end data flow from device to database"}),"\n",(0,r.jsx)(n.li,{children:"GraphQL query response format validation"}),"\n",(0,r.jsx)(n.li,{children:"Token authentication with user-cycle"}),"\n",(0,r.jsx)(n.li,{children:"Rate limiting enforcement"}),"\n",(0,r.jsx)(n.li,{children:"Data retention policy execution"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"e2e-tests",children:"E2E Tests"}),"\n",(0,r.jsxs)(n.p,{children:["Location: ",(0,r.jsx)(n.code,{children:"web-app/e2e/telemetry.spec.ts"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Flows:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"View real-time sensor data on hive dashboard"}),"\n",(0,r.jsx)(n.li,{children:"Query historical data with time range selector"}),"\n",(0,r.jsx)(n.li,{children:"Export telemetry data as CSV"}),"\n",(0,r.jsx)(n.li,{children:"Set up threshold alerts based on metrics"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-performance-considerations",children:"\u{1F4CA} Performance Considerations"}),"\n",(0,r.jsx)(n.h4,{id:"optimizations",children:"Optimizations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database Indexes"}),": Composite indexes on (hive_id, timestamp) for fast range queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query Caching"}),": Apollo Server caching for frequently accessed time ranges (5 min TTL)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connection Pooling"}),": MySQL connection pool (min: 10, max: 100)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batch Inserts"}),": Group multiple metrics from same device into single transaction"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query Limits"}),": Maximum 10,000 data points per query to prevent memory issues"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Aggregation"}),": Pre-calculate daily aggregates for long time ranges (over 30 days)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"bottlenecks",children:"Bottlenecks"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"High-frequency writes"}),": Sensors send data every 5 seconds, approximately 17,280 inserts per hive per day"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Large time-range queries"}),": Queries over 1 year require aggregation to avoid memory issues"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Concurrent device writes"}),": MySQL write locks during bulk inserts from multiple devices"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Grafana load"}),": Complex dashboard queries can generate 20+ database queries simultaneously"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query response time"}),": under 500ms for 24-hour range, under 2 seconds for 30-day range"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Write throughput"}),": over 1000 metrics per second across all devices"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database size"}),": approximately 500MB per hive per year (raw metrics)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Success rate"}),": over 99.5% (excluding network failures)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API availability"}),": over 99.9% uptime (monitored via health checks)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Performance Monitoring:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface PerformanceMetrics {\n  queryDuration: number;\n  dataPoints: number;\n  cacheHit: boolean;\n  dbConnectionTime: number;\n}\n\nasync function logQueryPerformance(\n  operation: string,\n  metrics: PerformanceMetrics\n) {\n  if (metrics.queryDuration > 2000) {\n    logger.warn('Slow query detected', { operation, metrics });\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-technical-limitations",children:"\u{1F6AB} Technical Limitations"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Current Constraints:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Maximum query range: 2 years without aggregation"}),"\n",(0,r.jsx)(n.li,{children:"Data point limit per query: 10,000 records"}),"\n",(0,r.jsx)(n.li,{children:"Write frequency: minimum 1 second interval per device"}),"\n",(0,r.jsx)(n.li,{children:"Supported metrics: temperature, humidity, weight, entrance traffic only"}),"\n",(0,r.jsx)(n.li,{children:"No real-time websocket streaming (polling only)"}),"\n",(0,r.jsx)(n.li,{children:"Grafana requires separate authentication (not SSO integrated)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Known Issues:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Daylight saving time transitions can create timestamp gaps in charts"}),"\n",(0,r.jsx)(n.li,{children:"Device clock drift can cause out-of-order inserts"}),"\n",(0,r.jsx)(n.li,{children:"MySQL date partitioning not yet implemented (planned for high-volume users)"}),"\n",(0,r.jsx)(n.li,{children:"No automatic outlier detection or data smoothing"}),"\n",(0,r.jsx)(n.li,{children:"Entrance traffic metrics require box_id (not hive-level aggregation)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Future Improvements:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add support for CO2, pressure, audio, vibration sensors"}),"\n",(0,r.jsx)(n.li,{children:"Implement websocket subscriptions for real-time updates"}),"\n",(0,r.jsx)(n.li,{children:"Add predictive analytics and anomaly detection"}),"\n",(0,r.jsx)(n.li,{children:"Create automated report generation"}),"\n",(0,r.jsx)(n.li,{children:"Implement data compression for older metrics (over 1 year)"}),"\n",(0,r.jsx)(n.li,{children:"Add multi-hive aggregation queries for apiary-level analytics"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-related-documentation",children:"\u{1F517} Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/about/products/web_app/pro-tier/hive_telemetry_storage",children:"Hive Telemetry Storage (User Guide)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/about/products/web_app/flexible-tier/alerts",children:"Alert Management"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/about/products/web_app/pro-tier/colony_comparison_analytics",children:"Colony Comparison Analytics"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/API/GraphQL",children:"GraphQL API Reference"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/API/REST",children:"REST API Reference"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/API/Authentication",children:"Authentication Guide"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-development-resources",children:"\u{1F4DA} Development Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub Repository"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/Gratheon/telemetry-api",children:"telemetry-api"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Architecture Diagram"}),": Available in repository README"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Schema"}),": ",(0,r.jsx)(n.code,{children:"/schema.graphql"})," in repository"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database Migrations"}),": ",(0,r.jsx)(n.code,{children:"/migrations"})," directory"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Grafana Dashboards"}),": ",(0,r.jsx)(n.code,{children:"/grafana/dashboards"})," (JSON exports)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-technical-notes",children:"\u{1F4AC} Technical Notes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation Decisions:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Chose MySQL over InfluxDB/ClickHouse to reduce operational complexity (single database engine)"}),"\n",(0,r.jsx)(n.li,{children:"REST API maintained for legacy device compatibility (new devices should use GraphQL)"}),"\n",(0,r.jsx)(n.li,{children:"Polling instead of websockets for simpler scaling and lower server resource usage"}),"\n",(0,r.jsx)(n.li,{children:"Separate table for entrance traffic due to different schema (multiple metrics per timestamp)"}),"\n",(0,r.jsx)(n.li,{children:"Short field names (t, v) in GraphQL responses to optimize mobile data usage"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Integration Considerations:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Devices must handle network interruptions gracefully (buffer and retry)"}),"\n",(0,r.jsx)(n.li,{children:"API tokens should be rotated every 90 days for security"}),"\n",(0,r.jsx)(n.li,{children:"Large time-range queries should use aggregation to prevent timeout"}),"\n",(0,r.jsx)(n.li,{children:"Grafana embedding requires CORS configuration on telemetry-api"}),"\n",(0,r.jsx)(n.li,{children:"Data retention policies executed daily via cron job (deletes old records)"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"change-log",children:"Change Log"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Last Updated"}),": December 6, 2025"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},18439(e,n,i){i.d(n,{R:()=>a,x:()=>l});var t=i(30758);let r={},s=t.createContext(r);function a(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);